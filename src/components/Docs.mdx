import {
  Meta,
  Canvas,
  Story,
  ArgTypes,
  Description,
} from "@storybook/addon-docs/blocks";
import { Example } from "../../.storybook/blocks/Example";
import * as ListStories from "./list.stories";

<hgroup>

# @form-atoms/list-atom

The Jotai `form-atoms` extension to render performant lists with easy controls.

<nav>
  <ul>
    <li>
      <a
        aria-label="GitHub Stars"
        href="https://github.com/form-atoms/list-atom"
      >
        <img
          alt="GitHub Stars"
          src="https://img.shields.io/github/stars/form-atoms/list-atom?style=for-the-badge&labelColor=24292e&logo=github"
        />
      </a>
    </li>
    <li>
      <a
        aria-label="Minzipped size"
        href="https://bundlephobia.com/result?p=%40form-atoms/list-atom"
      >
        <img
          alt="Bundlephobia"
          src="https://img.shields.io/bundlephobia/minzip/%40form-atoms/list-atom?style=for-the-badge&labelColor=24292e"
        />
      </a>
    </li>
    <li>
      <a
        aria-label="NPM version"
        href="https://www.npmjs.com/package/%40form-atoms/list-atom"
      >
        <img
          alt="NPM Version"
          src="https://img.shields.io/npm/v/%40form-atoms/list-atom?style=for-the-badge&labelColor=24292e"
        />
      </a>
    </li>
    <li>
      <a
        aria-label="Code coverage report"
        href="https://codecov.io/gh/form-atoms/list-atom"
      >
        <img
          alt="Code coverage"
          src="https://img.shields.io/codecov/c/gh/form-atoms/list-atom?style=for-the-badge&labelColor=24292e"
        />
      </a>
    </li>
  </ul>
</nav>

</hgroup>

## Features

- üèéÔ∏è **Performant rendering**. Each list item is rendered with a stable `key` derived from Jotai atom.
- üéÆ **Easy controls**. The `<List.Item>` provides `add`, `remove`, `moveUp` and `moveDown` actions for each item.
- üß© **Compound JSX Components**. Use the `<List.Add />`, or `<List.Empty />` instead of manual hooks.
- üîë **Scoped field `name`s**. The fields are dynamically indexed enabling serialization to `FormData`.
- üê¢ **Lists all the way down**. Render lists <sup>within lists <sup>within lists...</sup></sup> with the `<List.Nested>` alias `<ListOf>`.

## Quick start

```tsx
import { fieldAtom, formAtom, useForm, InputField } from "form-atoms";
import { listAtom, createList } from "@form-atoms/list-atom";

// Step 1: define your list
const environment = listAtom({
  name: "environment",
  value: [],
  fields: () => ({
    variable: fieldAtom({ name: "variable", value: "" }),
    value: fieldAtom({ name: "value", value: "" }),
  }),
});

// Step 2: Attach to form
const form = formAtom({ environment });

// Step 3: create compound list components
const { List } = createList(environment);

// Step 4: render your UI controls
function Example() {
  const { submit } = useForm(form);

  return (
    <form onSubmit={submit(console.log)}>
      <List initialValue={[{ variable: "NPM_TOKEN", value: "deepsecret" }]}>
        <List.Item>
          {({ fields, remove }) => (
            <fieldset role="group">
              <InputField atom={fields.variable} component="input" />
              <InputField atom={fields.value} component="input" />
              <button
                type="button"
                className="outline secondary"
                onClick={remove}
              >
                Remove
              </button>
            </fieldset>
          )}
        </List.Item>
        <List.Add />
      </List>
    </form>
  );
}
```

<Example of={ListStories.FullDemo}>

```tsx
import { InputField, fieldAtom } from "form-atoms";
import { listAtom, createList } from "@form-atoms/list-atom";

const envVars = listAtom({
  value: [],
  fields: () => ({
    variable: fieldAtom({ name: "variable", value: "" }),
    value: fieldAtom({ name: "value", value: "" }),
  }),
});

const { List } = createList(envVars);

const Example = () => (
  <List initialValue={[{ variable: "NPM_TOKEN", value: "deepsecret" }]}>
    <List.Item>
      {({ fields, remove }) => (
        <div
          style={{
            display: "grid",
            gridGap: 16,
            gridTemplateColumns: "auto auto min-content",
          }}
        >
          <InputField
            atom={fields.variable}
            render={(props) => <input {...props} placeholder="Variable Name" />}
          />
          <InputField
            atom={fields.value}
            render={(props) => (
              <input {...props} placeholder="Variable Value" />
            )}
          />
          <button type="button" className="outline secondary" onClick={remove}>
            Remove
          </button>
        </div>
      )}
    </List.Item>
    <List.Add>
      {({ add }) => (
        <button type="button" className="outline" onClick={() => add()}>
          Add variable
        </button>
      )}
    </List.Add>
  </List>
);
```

</Example>
