import {
  Meta,
  Canvas,
  Story,
  ArgTypes,
  Description,
} from "@storybook/addon-docs/blocks";
import { Example } from "../../.storybook/blocks/Example";
import * as ListStories from "./list.stories";

{/* <Meta of={ListStories} /> */}

<hgroup>

<p class="category">Components</p>

# @form-atoms/list-atom

The Jotai `form-atoms` extension to render performant lists with easy controls.

</hgroup>

```tsx
import { fieldAtom, formAtom, useForm, InputField } from "form-atoms";
import { listAtom, createList } from "@form-atoms/list-atom";

// Step 1: define your list
const environment = listAtom({
  name: "environment",
  value: [],
  fields: () => ({
    variable: fieldAtom({ name: "variable", value: "" }),
    value: fieldAtom({ name: "value", value: "" }),
  }),
});

// Step 2: Attach to form
const form = formAtom({ environment });

// Step 3: create compound list components
const { List } = createList(environment);

// Step 4: render your UI controls
function Example() {
  const { submit } = useForm(form);

  return (
    <form onSubmit={submit(console.log)}>
      <List initialValue={[{ variable: "NPM_TOKEN", value: "deepsecret" }]}>
        <List.Item>
          {({ fields, remove }) => (
            <fieldset role="group">
              <InputField atom={fields.variable} component="input" />
              <InputField atom={fields.value} component="input" />
              <button
                type="button"
                className="outline secondary"
                onClick={remove}
              >
                Remove
              </button>
            </fieldset>
          )}
        </List.Item>
        <List.Add />
      </List>
    </form>
  );
}
```

## Features

- ✅ **Performant rendering**. Each list item is rendered with a stable `key` derived from an internal form atom.
- ✅ Handles **adding, removal and ordering** of the list items.
- ✅ **Reorder items** with pre-configured **`moveUp` & `moveDown` actions.**
- ✅ **Blank Slate ready**. Can render a custom `<Empty />` component via render prop when the list is empty.
- ✅ Scoped field `name` attribute with dynamic index position.
- ✅ Supports **nesting list within item**.

<Example of={ListStories.FullDemo}>

```tsx
import { InputField, fieldAtom } from "form-atoms";
import { listAtom, createList } from "@form-atoms/list-atom";

const envVars = listAtom({
  value: [],
  fields: () => ({
    variable: fieldAtom({ name: "variable", value: "" }),
    value: fieldAtom({ name: "value", value: "" }),
  }),
});

const { List } = createList(envVars);

const Example = () => (
  <List initialValue={[{ variable: "NPM_TOKEN", value: "deepsecret" }]}>
    <List.Item>
      {({ fields, remove }) => (
        <div
          style={{
            display: "grid",
            gridGap: 16,
            gridTemplateColumns: "auto auto min-content",
          }}
        >
          <InputField
            atom={fields.variable}
            render={(props) => <input {...props} placeholder="Variable Name" />}
          />
          <InputField
            atom={fields.value}
            render={(props) => (
              <input {...props} placeholder="Variable Value" />
            )}
          />
          <button type="button" className="outline secondary" onClick={remove}>
            Remove
          </button>
        </div>
      )}
    </List.Item>
    <List.Add>
      {({ add }) => (
        <button type="button" className="outline" onClick={() => add()}>
          Add variable
        </button>
      )}
    </List.Add>
  </List>
);
```

</Example>
